language: cpp

matrix:
  include:
    - os: linux
      dist: trusty
      sudo: required
    - os: osx
      osx_image: xcode7.2
      compiler: clang

install:
- '[ "$TRAVIS_OS_NAME" != osx ] || brew install boost || echo -'
- '[ "$TRAVIS_OS_NAME" != osx ] || brew install openssl || echo -'
- '[ "$TRAVIS_OS_NAME" != osx ] || brew install miniupnpc'
- '[ "$TRAVIS_OS_NAME" != osx ] || brew install qt$BREW'
- '[ "$TRAVIS_OS_NAME" != osx ] || brew link --force qt$BREW'
- qmake -v
before_script:
- '[[ "$TRAVIS_OS_NAME" != osx   || "$CXX" != clang++ ]] || export QMAKESPEC=macx-clang'
script:
- >
  if [[ $TRAVIS_OS_NAME == "linux" ]]; then
    sudo add-apt-repository --yes ppa:beineri/opt-qt593-trusty;
    sudo apt-get update;
    sudo apt-get -y install qt59-meta-minimal qt59tools;
    source /opt/qt59/bin/qt59-env.sh;
    export;
  else
    cd "$TRAVIS_BUILD_DIR";
    curl -fsSL -o db-4.8.30.NC.tar.gz https://github.com/bitbaymarket/bitbay-prebuilt-libs1/releases/download/base1/db-4.8.30.NC.tar.gz;
    tar -zxf db-4.8.30.NC.tar.gz;
    mv db-4.8.30.NC db;
    cd db;
    patch dbinc/atomic.h < ../doc/mac_db-4.8_atomic.patch;
    cd build_unix;
  fi;

- qmake -v
- cd "$TRAVIS_BUILD_DIR"
- qmake "CICD=travis_mac" bitbay-qt.pro
